# XDR 아키텍처 설계 문서

## 1. 시스템 아키텍처

### 1.1 전체 구성도
```
+===========================================================================+
|                           XDR 통합 플랫폼                                  |
+===========================================================================+
|  +------------------+  +------------------+  +------------------+          |
|  |   통합 대시보드   |  |   케이스 관리    |  |   리포팅 엔진   |          |
|  +------------------+  +------------------+  +------------------+          |
+---------------------------------------------------------------------------+
                                    |
                    +---------------+---------------+
                    |                               |
        +-----------v-----------+       +-----------v-----------+
        |    분석/탐지 계층      |       |     대응/자동화 계층   |
        +-----------------------+       +-----------------------+
        | - 상관분석 엔진        |       | - SOAR 플레이북       |
        | - ML/AI 탐지          |       | - 자동 대응 액션      |
        | - 위협 인텔리전스      |       | - 티켓팅 연동         |
        +-----------+-----------+       +-----------+-----------+
                    |                               |
+-------------------v-------------------------------v-------------------+
|                        데이터 계층 (Data Lake)                        |
+----------------------------------------------------------------------+
| +----------------+ +----------------+ +----------------+               |
| | 로그 저장소     | | 인덱스 서버    | | 메타데이터 DB  |               |
| | (Hot/Warm/Cold)| | (Elasticsearch)| | (PostgreSQL)  |               |
| +----------------+ +----------------+ +----------------+               |
+----------------------------------------------------------------------+
                                    ^
                    +---------------+---------------+
                    |               |               |
        +-----------+---+   +-------+-------+   +---+-----------+
        |    SIEM       |   |     EDR       |   |     NDR       |
        +---------------+   +---------------+   +---------------+
        | - 로그 수집    |   | - 프로세스     |   | - 패킷 분석   |
        | - 이벤트 파싱  |   | - 파일 활동    |   | - 플로우 분석 |
        | - 정규화       |   | - 레지스트리   |   | - DNS 분석    |
        +-------+-------+   +-------+-------+   +-------+-------+
                |                   |                   |
        +-------v-------+   +-------v-------+   +-------v-------+
        |  서버/애플리케이션 |   |  엔드포인트    |   |  네트워크 장비  |
        +---------------+   +---------------+   +---------------+
```

### 1.2 컴포넌트 상세

#### 데이터 수집 계층
| 컴포넌트 | 역할 | 기술 |
|----------|------|------|
| Log Collector | 로그 수집 및 전송 | Filebeat, Fluentd |
| EDR Agent | 엔드포인트 텔레메트리 | Elastic Defend, CrowdStrike |
| Network Sensor | 네트워크 트래픽 캡처 | Zeek, Suricata |

#### 데이터 처리 계층
| 컴포넌트 | 역할 | 기술 |
|----------|------|------|
| Message Queue | 데이터 버퍼링 | Kafka, Redis |
| Parser | 로그 파싱/정규화 | Logstash, Cribl |
| Enrichment | 컨텍스트 추가 | Custom Python |

#### 분석 계층
| 컴포넌트 | 역할 | 기술 |
|----------|------|------|
| Correlation Engine | 상관분석 규칙 실행 | Splunk, Elastic |
| ML Engine | 이상 탐지 | Elastic ML, Python |
| TI Platform | 위협 인텔리전스 | MISP, OpenCTI |

## 2. 데이터 흐름

### 2.1 수집 → 저장 → 분석
```
[데이터 소스]
     |
     v
[수집 에이전트] ---> [메시지 큐] ---> [파서/정규화]
                         |
                         v
                    [데이터 레이크]
                         |
          +--------------+--------------+
          |              |              |
          v              v              v
     [실시간 분석]  [배치 분석]   [대시보드]
          |              |
          v              v
     [알림 생성] <-------+
          |
          v
     [SOAR 연동]
```

### 2.2 알림 처리 흐름
```
[탐지 알림]
     |
     v
[알림 집계/중복제거]
     |
     v
[심각도 분류]
     |
     +---> [Critical/High] ---> [자동 대응] ---> [즉시 알림]
     |
     +---> [Medium] ---> [케이스 생성] ---> [분석가 할당]
     |
     +---> [Low] ---> [대시보드 표시] ---> [일일 리뷰]
```

## 3. 네트워크 구성

### 3.1 네트워크 세그먼트
```
+------------------------------------------------------------------+
|                        인터넷                                     |
+------------------------------------------------------------------+
                              |
                    [방화벽/IPS]
                              |
+------------------------------------------------------------------+
|                        DMZ                                        |
|  +------------+  +------------+  +------------+                   |
|  | 웹 서버    |  | 메일 서버  |  | DNS 서버   |                   |
|  +------------+  +------------+  +------------+                   |
+------------------------------------------------------------------+
                              |
                    [내부 방화벽]
                              |
+------------------------------------------------------------------+
|                     내부 네트워크                                  |
|  +-----------------+  +-----------------+  +-----------------+    |
|  | 업무 네트워크    |  | 서버 네트워크    |  | 보안 네트워크    |    |
|  | (사용자 PC)     |  | (앱/DB 서버)    |  | (XDR 인프라)    |    |
|  +-----------------+  +-----------------+  +-----------------+    |
+------------------------------------------------------------------+
```

### 3.2 데이터 수집 포인트
| 위치 | 수집 방법 | 데이터 유형 |
|------|-----------|-------------|
| 인터넷 경계 | TAP/미러링 | 외부 트래픽 |
| DMZ | TAP/미러링 + 로그 | 웹/메일 트래픽 |
| 내부 코어 | TAP/미러링 | 내부 트래픽 |
| 서버 | 에이전트 | 로그, 프로세스 |
| 엔드포인트 | 에이전트 | EDR 텔레메트리 |

## 4. 고가용성 설계

### 4.1 HA 구성
```
              [로드밸런서]
                   |
        +----------+----------+
        |                     |
   [노드 1]               [노드 2]
   (Active)               (Standby)
        |                     |
        +----------+----------+
                   |
           [공유 스토리지]
```

### 4.2 장애 대응
| 장애 유형 | 대응 방안 | RTO |
|-----------|-----------|-----|
| 단일 노드 장애 | 자동 페일오버 | < 5분 |
| 데이터센터 장애 | DR 사이트 전환 | < 1시간 |
| 네트워크 장애 | 로컬 버퍼링 | - |

## 5. 보안 요구사항

### 5.1 접근 제어
- 역할 기반 접근 제어 (RBAC)
- MFA 필수
- 최소 권한 원칙

### 5.2 데이터 보호
- 전송 중 암호화 (TLS 1.3)
- 저장 시 암호화 (AES-256)
- 로그 무결성 보장

### 5.3 감사
- 관리자 활동 로깅
- 규칙 변경 이력 관리
- 정기 접근 검토
